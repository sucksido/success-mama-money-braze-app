"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9543],{9543:(O,c,o)=>{o.r(c),o.d(c,{default:()=>N,refreshFeatureFlags:()=>j});var l=o(2437),f=o(1160),w=o(3433),g=o(3118),A=o(2822),F=o(6571),b=o(7194);class s{constructor(t,i=!1,r={},h){this.id=t,this.enabled=i,this.properties=r,this.trackingString=h,this.id=t,this.enabled=i,this.properties=r,this.trackingString=h}getStringProperty(t){const i=this.properties[t];return null==i?(this.Er(t),null):this.Ir(i)?i.value:(this.Nr("string"),null)}getNumberProperty(t){const i=this.properties[t];return null==i?(this.Er(t),null):this.Tr(i)?i.value:(this.Nr("number"),null)}getBooleanProperty(t){const i=this.properties[t];return null==i?(this.Er(t),null):this.Ar(i)?i.value:(this.Nr("boolean"),null)}ss(){const t={};return t[s.hs.ns]=this.id,t[s.hs.Fe]=this.enabled,t[s.hs.we]=this.properties,t[s.hs.ze]=this.trackingString,t}Nr(t){f.A.j.info(`Property is not of type ${t}.`)}Er(t){f.A.j.info(`${t} not found in feature flag properties.`)}Ir(t){return"string"===t.type&&"string"==typeof t.value}Tr(t){return"number"===t.type&&"number"==typeof t.value}Ar(t){return"boolean"===t.type&&"boolean"==typeof t.value}}function m(e){if(e[s.Tt.ns]&&"boolean"==typeof e[s.Tt.Fe])return new s(e[s.Tt.ns],e[s.Tt.Fe],e[s.Tt.we],e[s.Tt.ze]);f.A.j.info(`Unable to create feature flag from ${JSON.stringify(e,null,2)}`)}function T(e){if(e[s.hs.ns]&&"boolean"==typeof e[s.hs.Fe])return new s(e[s.hs.ns],e[s.hs.Fe],e[s.hs.we],e[s.hs.ze]);f.A.j.info(`Unable to deserialize feature flag from ${JSON.stringify(e,null,2)}`)}s.hs={ns:"id",Fe:"e",we:"pr",ze:"fts"},s.Tt={ns:"id",Fe:"enabled",we:"properties",ze:"fts"};var a=o(420);class z extends w.A{constructor(t,i,r){super(),this.wt=t,this.gt=i,this.u=r,this.pi=[],this.gi=0,this.wt=t,this.gt=i,this.u=r,this.Fi=null,this.wi=new A.A,this.yi=10,this.ji=null,this.bi=null,l.Ay.jt(this.wi)}Ts(t){if((!this.wt||this.wt.vi())&&null!=t&&t.feature_flags){this.pi=[];for(const i of t.feature_flags){const r=m(i);r&&this.pi.push(r)}this.gi=(new Date).getTime(),this.Ti(),this.wi.Et(this.pi)}}Di(){let t={};this.u&&(t=this.u.v(g.d.k.Ri));const i={};for(const r in t){const h=T(t[r]);h&&(i[h.id]=h)}return i}Ni(){var t;return(null===(t=this.u)||void 0===t?void 0:t.v(g.d.k.qi))||{}}xi(t){this.u&&this.u.D(g.d.k.qi,t)}ri(t){return this.wi.lt(t)}refreshFeatureFlags(t,i,r=!1,h=!0){if(!this.zi(r))return!this.Fi&&this.wt&&(this.Fi=this.wt.Ci(()=>{this.refreshFeatureFlags(t,i)})),void("function"==typeof i&&i());if(h&&this.Ii(),!this.gt)return void("function"==typeof i&&i());const p=this.gt.Bs({},!0),v=this.gt.Hs(p,a.A.Os.Si);let d=!1;this.gt.Qs(p,()=>{this.gt?(a.A.Ws(this.u,a.A.Os.Si,(new Date).valueOf()),b.A.Xs({url:`${this.gt.Ys()}/feature_flags/sync`,headers:v,data:p,O:u=>{if(!this.gt.Zs(p,u,v))return d=!0,void("function"==typeof i&&i());this.gt.ti(),this.Ts(u),d=!1,a.A.si(this.u,a.A.Os.Si,1),"function"==typeof t&&t()},error:u=>{this.gt.ii(u,"retrieving feature flags"),d=!0,"function"==typeof i&&i()},ei:()=>{if(h&&d&&!this.bi){a.A.hi(this.u,a.A.Os.Si);let u=this.ji;(null==u||u<1e3*this.yi)&&(u=1e3*this.yi),this.$i(Math.min(3e5,(0,F.C)(1e3*this.yi,3*u)),t,i,r)}}})):"function"==typeof i&&i()})}Ii(){null!=this.bi&&(clearTimeout(this.bi),this.bi=null)}$i(t=1e3*this.yi,i,r,h=!1){this.Ii(),this.bi=window.setTimeout(()=>{this.refreshFeatureFlags(i,r,h)},t),this.ji=t}zi(t){if(!this.wt)return!1;if(!t){const i=this.wt.Mi();if(null==i)return!1;let r=!1;if(!isNaN(i)){if(-1===i)return f.A.j.info("Feature flag refreshes not allowed"),!1;r=(new Date).getTime()>=(this.gi||0)+1e3*i}if(!r)return f.A.j.info(`Feature flag refreshes were rate limited to ${i} seconds`),!1}return this.wt.vi()}Ti(){if(!this.u)return;const t={};for(const i of this.pi){const r=i.ss();t[i.id]=r}this.u.D(g.d.k.Ri,t),this.u.D(g.d.k.Ui,this.gi)}}const n={t:!1,provider:null,er:()=>(n.o(),n.provider||(n.provider=new z(l.Ay.tr(),l.Ay.ar(),l.Ay.l()),l.Ay.dr(n.provider)),n.provider),o:()=>{n.t||(l.Ay.g(n),n.t=!0)},destroy:()=>{n.provider=null,n.t=!1}},S=n;function y(e,t,i=!1){if(l.Ay.rr())return S.er().refreshFeatureFlags(e,t,i)}function j(e,t){y(e,t)}const N=y}}]);